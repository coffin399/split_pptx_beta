name: PowerPoint å¤‰æ›ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

on:
  workflow_dispatch:
    inputs:
      file_url:
        description: 'PPTXãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰URLï¼ˆå…¬é–‹ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ãªã‚‚ã®ï¼‰'
        required: true
        type: string
      dpi:
        description: 'ã‚µãƒ ãƒã‚¤ãƒ«ç”¨DPIï¼ˆ50-150ï¼‰'
        required: false
        default: '100'
        type: string

jobs:
  convert:
    runs-on: ubuntu-latest
    timeout-minutes: 30
    
    steps:
    - name: ãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
      uses: actions/checkout@v4
      
    - name: Pythonç’°å¢ƒã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
        
    - name: ã‚·ã‚¹ãƒ†ãƒ ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
      run: |
        sudo apt-get update
        sudo apt-get install -y libreoffice poppler-utils fonts-noto-cjk
        
    - name: Pythonä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
      run: |
        pip install -r requirements_web.txt
        
    - name: ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆ
      run: |
        mkdir -p uploads temp output
        
    - name: PPTXãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
      run: |
        curl -L "${{ github.event.inputs.file_url }}" -o uploads/input.pptx
        
    - name: PowerPointã‚’å¤‰æ›
      env:
        DPI: ${{ github.event.inputs.dpi }}
      run: |
        python3 -c "
        import os
        import sys
        sys.path.append('.')
        from app import generate_script_slides
        from pathlib import Path
        import time

        # Set DPI from input
        os.environ['THUMBNAIL_DPI'] = os.getenv('DPI', '100')

        def reporter(message: str) -> None:
            timestamp = time.strftime('%Y-%m-%d %H:%M:%S')
            print(f"[{timestamp}] {message}")

        # Convert file
        input_path = Path('uploads/input.pptx')
        output_path = generate_script_slides(input_path, Path('temp'), reporter)
        print(f'Output: {output_path}')

        # Copy to output directory
        import shutil
        shutil.copy2(output_path, 'output/converted.pptx')
        print('Conversion completed successfully!')
        "
        
    - name: çµæžœãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
      uses: actions/upload-artifact@v4
      with:
        name: å¤‰æ›æ¸ˆã¿ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³
        path: output/
        retention-days: 1
        
    - name: ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ¡ˆå†…ã‚’ä½œæˆ
      run: |
        echo "## ðŸ“¥ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æº–å‚™å®Œäº†" >> $GITHUB_STEP_SUMMARY
        echo "å¤‰æ›æ¸ˆã¿ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãŒå¯èƒ½ã«ãªã‚Šã¾ã—ãŸã€‚" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "1. ã“ã®ãƒªãƒã‚¸ãƒˆãƒªã® **Actions** ã‚¿ãƒ–ã‚’é–‹ãã¾ã™" >> $GITHUB_STEP_SUMMARY
        echo "2. ä»Šå›žã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®Ÿè¡Œã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™" >> $GITHUB_STEP_SUMMARY
        echo "3. **å¤‰æ›æ¸ˆã¿ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³** ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "â° ãƒ•ã‚¡ã‚¤ãƒ«ã¯1æ—¥é–“ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¯èƒ½ã§ã™" >> $GITHUB_STEP_SUMMARY
